

  <!DOCTYPE html>
  <html lang="en">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="renderer" content="webkit">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="description" content=嘿，我是ZhaoWu～这是我的Blog. >
  <meta name="keywords" content=hexo,Reverse,CTF >

  <head>
    <title>
      TEA系列算法 [ Hexo ]
    </title>
  <meta name="generator" content="Hexo 7.3.0"></head>

  <body>

    <link rel="stylesheet" href="/css/header.css">
<div class="header">
  <div class="logo">
    <span class="pull-left">
      <a id="site-name" href="/">
        ZhaoWu&#39;s blog
      </a>
    </span>
  </div>
  <ul class="nav-list">
    
      <li>
        <a href="/">
          首页
        </a>
      </li>
      
  </ul>
</div>

      <!--<link rel="stylesheet" href="/css/top-header.css">
<div id="top-bar" class="fixed">

  <a class="goto-top" href="#"></a>
  <ul class="bar-list bar-list-1">
    
      <li>
        <p>
          <a href="/">
            <text class="bar-text bar-p1">
              首页
            </text>
            <text class="bar-text bar-p2"></text>
          </a>
          <text class="bar-p3">/</text>
        </p>
      </li>
      
  </ul>
</div>-->

        <div id="content-outer">
          <div class="content-inner">
            <link rel="stylesheet" href="/css/post.css">
<div class="posts">
  <a href="/index.html"><i class="fa fa-home
replay-btn" aria-hidden="true"></i></a>
  <div class="post-title">
    <p>
      TEA系列算法
    </p>
    <hr>
  </div>
  <div class="post-content">
    <p>TEA (Tiny Encryption Algorithm)、XTEA (Extended Tiny Encryption Algorithm)和XXTEA (Corrected Block TEA)都是<strong>对称加密算法。</strong><br>TEA算法是David Wheeler和Roger Needham在1994年提出的一种简单的加密算法。TEA采用与DES算法类似的Feistel结构，迭代的每次循环使用加法和移位操作，对明文和密钥进行扩散和混乱，实现明文的非线性变换。TEA密钥长度和迭代次数都是DES的两倍，抗“试错法”攻击的强度不低于DES算法。算法以32bits为运算单位，而不是耗费计算能力的逐位运算。<br>XTEA算法与TEA算法一样，将明文数据<strong>分块加密</strong>，并使用相同的加密密钥进行加密和解密操作。每个数据块的长度为64位（8字节），并且通过多次迭代运算来实现加密。具体来说，每个数据块经过64轮迭代加密，每轮迭代包括两个32位的运算过程。XTEA算法的加密变换过程是基于轮函数的迭代运算。这些运算在每轮中都会重复进行，使得算法具有迭代扩散特性，增加了对明文的混淆和扩散效果。<br>XXTEA算法是使用TEA算法作为基础的一种改进版本，XXTEA算法可以加密任意长度的数据，而<strong>不仅限于64位的块</strong>。XXTEA算法进行32轮迭代加密，采用了修正后的差分运算。</p>
<h2 id="一、TEA"><a href="#一、TEA" class="headerlink" title="一、TEA"></a>一、TEA</h2><p>TEA系列算法中均使用了一个DELTA常数，但DELTA的值对算法并无什么影响，只是为了避免不良的取值，推荐DELTA的值取为黄金分割数(<img src="https://cdn.nlark.com/yuque/__latex/e109dbfdcd927bfa6f9c609a0b0f36b1.svg#card=math&code=%5Csqrt%7B5%7D%20-1%5Cover%202&id=wAWl6">)与232的乘积，取整后的十六进制值为<strong>0x9e3779B9</strong>，用于保证每一轮加密都不相同。   加密使用的数据为<strong>2个32位无符号整数</strong>，密钥为<strong>4个32位无符号整数即密钥长度为128位</strong><br><img src="https://cdn.nlark.com/yuque/0/2023/png/36043746/1690816390062-564faafd-474d-485b-b4f3-eaa89b8d5453.png#averageHue=%23f5f0ee&clientId=u758c436c-caa4-4&from=paste&height=604&id=u183df55d&originHeight=755&originWidth=1092&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=143493&status=done&style=none&taskId=ufbbc131c-6db9-49f1-93bf-e223192fe01&title=&width=873.6" alt="22dc68f9661ebbe2ebe2fff7af2b6c91.png"><br>C代码如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">encrypt</span> <span class="params">(<span class="type">uint32_t</span> *v,<span class="type">uint32_t</span> *k )</span>&#123;</span><br><span class="line">	<span class="type">uint32_t</span> v0=v[<span class="number">0</span>],v1=v[<span class="number">1</span>],sum=<span class="number">0</span>,i;</span><br><span class="line">	<span class="type">uint32_t</span> delta=<span class="number">0x9e3779b9</span>;</span><br><span class="line">	<span class="type">uint32_t</span> k0=k[<span class="number">0</span>],k1=k[<span class="number">1</span>],k2=k[<span class="number">2</span>],k3=k[<span class="number">3</span>];</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">32</span>;i++)&#123;</span><br><span class="line">		sum+=delta;</span><br><span class="line">		v0+=((v1&lt;&lt;<span class="number">4</span>)+k0)^(v1+sum)^((v1&gt;&gt;<span class="number">5</span>)+k1);</span><br><span class="line">		v1+=((v0&lt;&lt;<span class="number">4</span>)+k2)^(v0+sum)^((v0&gt;&gt;<span class="number">5</span>)+k3);</span><br><span class="line">	&#125; </span><br><span class="line">	v[<span class="number">0</span>]=v0;v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">decrypt</span> <span class="params">(<span class="type">uint32_t</span> *v,<span class="type">uint32_t</span> *k)</span>&#123;</span><br><span class="line">	<span class="type">uint32_t</span> v0=v[<span class="number">0</span>],v1=v[<span class="number">1</span>],sum=<span class="number">0xC6EF3720</span>,i;	<span class="comment">//这里的sum是0x9e3779b9*32后截取32位的结果，截取很重要。</span></span><br><span class="line">	<span class="type">uint32_t</span> delta=<span class="number">0x9e3779b9</span>;</span><br><span class="line">	<span class="type">uint32_t</span> k0=k[<span class="number">0</span>],k1=k[<span class="number">1</span>],k2=k[<span class="number">2</span>],k3=k[<span class="number">3</span>];</span><br><span class="line">	<span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;<span class="number">32</span>;i++)&#123;</span><br><span class="line">		v1-=((v0&lt;&lt;<span class="number">4</span>)+k2)^(v0+sum)^((v0&gt;&gt;<span class="number">5</span>)+k3);</span><br><span class="line">		v0-=((v1&lt;&lt;<span class="number">4</span>)+k0)^(v1+sum)^((v1&gt;&gt;<span class="number">5</span>)+k1);</span><br><span class="line">		sum-=delta;</span><br><span class="line">	&#125; </span><br><span class="line">	v[<span class="number">0</span>]=v0;v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> v[<span class="number">2</span>]=&#123;<span class="number">1</span>,<span class="number">2</span>&#125;,k[<span class="number">4</span>]=&#123;<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;加密前的数据：%u %u\n&quot;</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);	<span class="comment">//%u 以十进制形式输出无符号整数 </span></span><br><span class="line">	encrypt(v,k);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;加密后数据：%u %u\n&quot;</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);</span><br><span class="line">	decrypt(v,k);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;解密后数据：%u %u\n&quot;</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>python代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> * </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">v,k</span>):</span><br><span class="line">	v0=c_uint32(v[<span class="number">0</span>])</span><br><span class="line">	v1=c_uint32(v[<span class="number">1</span>])</span><br><span class="line">	sum1=c_uint32(<span class="number">0</span>)</span><br><span class="line">	delta=<span class="number">0x9e3779b9</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">		sum1.value+=delta</span><br><span class="line">		v0.value+=((v1.value&lt;&lt;<span class="number">4</span>)+k[<span class="number">0</span>])^(v1.value+sum1.value)^((v1.value&gt;&gt;<span class="number">5</span>)+k[<span class="number">1</span>])</span><br><span class="line">		v1.value+=((v0.value&lt;&lt;<span class="number">4</span>)+k[<span class="number">2</span>])^(v0.value+sum1.value)^((v0.value&gt;&gt;<span class="number">5</span>)+k[<span class="number">3</span>])</span><br><span class="line">	<span class="keyword">return</span> v0.value,v1.value</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">v,k</span>):</span><br><span class="line">	v0=c_uint32(v[<span class="number">0</span>])</span><br><span class="line">	v1=c_uint32(v[<span class="number">1</span>])</span><br><span class="line">	delta=<span class="number">0x9e3779b9</span></span><br><span class="line">	sum1=c_uint32(delta*<span class="number">32</span>)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">		v1.value-=((v0.value&lt;&lt;<span class="number">4</span>)+k[<span class="number">2</span>])^(v0.value+sum1.value)^((v0.value&gt;&gt;<span class="number">5</span>)+k[<span class="number">3</span>])</span><br><span class="line">		v0.value-=((v1.value&lt;&lt;<span class="number">4</span>)+k[<span class="number">0</span>])^(v1.value+sum1.value)^((v1.value&gt;&gt;<span class="number">5</span>)+k[<span class="number">1</span>])</span><br><span class="line">		sum1.value-=delta</span><br><span class="line">	<span class="keyword">return</span> v0.value,v1.value</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	a=[<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line">	k=[<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;加密前数据:&quot;</span>,a)</span><br><span class="line">	res=encrypt(a,k)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;加密后的数据:&quot;</span>,res)</span><br><span class="line">	res=decrypt(res,k)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;解密后数据:&quot;</span>,res)</span><br></pre></td></tr></table></figure>
<p>算法主要是一个32轮的循环，<strong>每一次对v1,v0,sum进行一个叠加操作，每次加一个一串异或的操作值，</strong>所以解密的时候只要把sum算出来，然后倒过来就行。</p>
<h2 id="二、XTEA"><a href="#二、XTEA" class="headerlink" title="二、XTEA"></a>二、XTEA</h2><p> XTEA是TEA的升级版，增加了更多的密钥表，移位和异或操作等等。<br>与TEA相比，**XTEA把sum累加放在了中间，同时融入了位与的操作。 **<br><img src="https://cdn.nlark.com/yuque/0/2023/png/36043746/1690816575087-08e090e9-0459-49fc-b5ac-29071159fd42.png#averageHue=%239bd578&clientId=u758c436c-caa4-4&from=paste&height=597&id=u43db9cef&originHeight=746&originWidth=1108&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=335427&status=done&style=none&taskId=u05afd538-fcf7-480e-8a2a-faffe6b5987&title=&width=886.4" alt="image.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">encipher</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> num_rounds, <span class="type">uint32_t</span> v[<span class="number">2</span>], <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span>&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">	<span class="type">uint32_t</span> v0=v[<span class="number">0</span>],v1=v[<span class="number">1</span>],sum=<span class="number">0</span>,delta=<span class="number">0x9E3779B9</span>;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;num_rounds;i++)&#123;</span><br><span class="line">		v0+=(((v1&lt;&lt;<span class="number">4</span>)^(v1&gt;&gt;<span class="number">5</span>))+v1)^(sum+key[sum&amp;<span class="number">3</span>]);</span><br><span class="line">		sum+=delta;</span><br><span class="line">		v1+=(((v0&lt;&lt;<span class="number">4</span>)^(v0&gt;&gt;<span class="number">5</span>))+v0)^(sum+key[(sum&gt;&gt;<span class="number">11</span>)&amp;<span class="number">3</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">	v[<span class="number">0</span>]=v0;v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">decipher</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> num_rounds,<span class="type">uint32_t</span> v[<span class="number">2</span>],<span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span>&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">	<span class="type">uint32_t</span> v0=v[<span class="number">0</span>],v1=v[<span class="number">1</span>],delta=<span class="number">0x9E3779B9</span>,sum=delta*num_rounds;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;num_rounds;i++)&#123;</span><br><span class="line">	v1-=(((v0&lt;&lt;<span class="number">4</span>)^(v0&gt;&gt;<span class="number">5</span>))+v0)^(sum+key[(sum&gt;&gt;<span class="number">11</span>)&amp;<span class="number">3</span>]);</span><br><span class="line">	sum-=delta;</span><br><span class="line">	v0-=(((v1&lt;&lt;<span class="number">4</span>)^(v1&gt;&gt;<span class="number">5</span>))+v1)^(sum+key[sum&amp;<span class="number">3</span>]);</span><br><span class="line">	&#125; </span><br><span class="line">	v[<span class="number">0</span>]=v0;v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="type">uint32_t</span> v[<span class="number">2</span>]=&#123;<span class="number">1</span>,<span class="number">2</span>&#125;;</span><br><span class="line">	<span class="type">uint32_t</span> <span class="type">const</span> k[<span class="number">4</span>]=&#123;<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> r=<span class="number">32</span>;				<span class="comment">//这里是加密轮数，自己设置 </span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;加密前原始数据：%u %u\n&quot;</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);</span><br><span class="line">	encipher(r,v,k);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;加密后原始数据：%u %u\n&quot;</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);</span><br><span class="line">	decipher(r,v,k);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;解密后原始数据：%u %u\n&quot;</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>python写法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> * </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">v,k</span>):</span><br><span class="line">	v0=c_uint32(v[<span class="number">0</span>])</span><br><span class="line">	v1=c_uint32(v[<span class="number">1</span>])</span><br><span class="line">	sum1=c_uint32(<span class="number">0</span>)</span><br><span class="line">	delta=<span class="number">0x9e3779b9</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">		v0.value+=(((v1.value&lt;&lt;<span class="number">4</span>)^(v1.value&gt;&gt;<span class="number">5</span>))+v1.value)^(sum1.value+k[sum1.value&amp;<span class="number">3</span>])</span><br><span class="line">		sum1.value+=delta</span><br><span class="line">		v1.value+=(((v0.value&lt;&lt;<span class="number">4</span>)^(v0.value&gt;&gt;<span class="number">5</span>))+v0.value)^(sum1.value+k[(sum1.value&gt;&gt;<span class="number">11</span>)&amp;<span class="number">3</span>])</span><br><span class="line">	<span class="keyword">return</span> v0.value,v1.value</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">v,k</span>):</span><br><span class="line">	v0=c_uint32(v[<span class="number">0</span>])</span><br><span class="line">	v1=c_uint32(v[<span class="number">1</span>])</span><br><span class="line">	delta=<span class="number">0x9e3779b9</span></span><br><span class="line">	sum1=c_uint32(delta*<span class="number">32</span>)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">		v1.value-=(((v0.value&lt;&lt;<span class="number">4</span>)^(v0.value&gt;&gt;<span class="number">5</span>))+v0.value)^(sum1.value+k[(sum1.value&gt;&gt;<span class="number">11</span>)&amp;<span class="number">3</span>])</span><br><span class="line">		sum1.value-=delta</span><br><span class="line">		v0.value-=(((v1.value&lt;&lt;<span class="number">4</span>)^(v1.value&gt;&gt;<span class="number">5</span>))+v1.value)^(sum1.value+k[sum1.value&amp;<span class="number">3</span>])</span><br><span class="line">	<span class="keyword">return</span> v0.value,v1.value</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	a=[<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line">	k=[<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;加密前数据:&quot;</span>,a)</span><br><span class="line">	res=encrypt(a,k)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;加密后的数据:&quot;</span>,res)</span><br><span class="line">	res=decrypt(res,k)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;解密后数据:&quot;</span>,res)</span><br></pre></td></tr></table></figure>
<h2 id="三、XXTEA"><a href="#三、XXTEA" class="headerlink" title="三、XXTEA"></a>三、XXTEA</h2><p>与XTEA相比，<strong>XXTEA自定义了轮数，同时出现了MX函数</strong>。 XXTEA是一个非平衡Feistel网络分组密码，在可变长度块上运行，这些块是32位大小的任意倍数（最小64位），使用128位密钥, 是目前TEA系列中最安全的算法，但性能较上两种有所降低。  XXTEA的解密除了是外面的轮循环要反着写，里面的for到n-1也要反着<br><img src="https://cdn.nlark.com/yuque/0/2023/png/36043746/1690816199270-ec67ccd3-aaf2-4b5f-9b4e-7617d3a3ff08.png#averageHue=%232d2d2d&clientId=u758c436c-caa4-4&from=paste&height=370&id=u6d8e2815&originHeight=462&originWidth=391&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=33867&status=done&style=none&taskId=u69389cc4-72c2-4daf-995a-2fb4f44660d&title=&width=312.8" alt="20200720005804592.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/36043746/1690816648621-54390e53-4ca6-4588-97c7-f5744d83bd79.png#averageHue=%23f2e7e4&clientId=u758c436c-caa4-4&from=paste&height=565&id=u197aebc5&originHeight=706&originWidth=1115&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=468217&status=done&style=none&taskId=u5a45cd03-0bfb-4fa2-a01a-e1345a34426&title=&width=892" alt="image.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DELTA 0x933779b9</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MX (((z&gt;&gt;5^y<span class="string">&lt;&lt;2)+(y&gt;</span>&gt;3^z&lt;&lt;4))^((sum^y)+(key[(p&amp;3)^e]^z)))</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">btea</span><span class="params">(<span class="type">uint32_t</span> *v,<span class="type">int</span> n,<span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> y,z,sum;</span><br><span class="line">	<span class="type">unsigned</span> p,rounds,e;</span><br><span class="line">	<span class="keyword">if</span>(n&gt;<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		rounds=<span class="number">6</span>+<span class="number">52</span>/n;	<span class="comment">//这里可以说是预定义值，n=2是rounds=32</span></span><br><span class="line">		sum=<span class="number">0</span>;</span><br><span class="line">		z=v[n<span class="number">-1</span>];</span><br><span class="line">		<span class="keyword">do</span></span><br><span class="line">		&#123;</span><br><span class="line">			sum+=DELTA;</span><br><span class="line">			e=(sum&gt;&gt;<span class="number">2</span>)&amp;<span class="number">3</span>;</span><br><span class="line">			<span class="keyword">for</span>(p=<span class="number">0</span>;p&lt;n<span class="number">-1</span>;p++)        <span class="comment">//注意这里的p是从0~n-1</span></span><br><span class="line">			&#123;</span><br><span class="line">				y=v[p+<span class="number">1</span>];</span><br><span class="line">				z=v[p]+=MX;</span><br><span class="line">			&#125;</span><br><span class="line">			y=v[<span class="number">0</span>];</span><br><span class="line">			z=v[n<span class="number">-1</span>]+=MX;        <span class="comment">//这里的MX中传入的p=n-1</span></span><br><span class="line">		&#125;	</span><br><span class="line">		<span class="keyword">while</span>(--rounds);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(n&lt;<span class="number">-1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		n=-n;</span><br><span class="line">		rounds=<span class="number">6</span>+<span class="number">52</span>/n;</span><br><span class="line">		sum=rounds*DELTA;</span><br><span class="line">		y=v[<span class="number">0</span>];</span><br><span class="line">		<span class="keyword">do</span></span><br><span class="line">		&#123;</span><br><span class="line">			e=(sum&gt;&gt;<span class="number">2</span>)&amp;<span class="number">3</span>;</span><br><span class="line">			<span class="keyword">for</span>(p=n<span class="number">-1</span>;p&gt;<span class="number">0</span>;p--)    <span class="comment">//注意这里的p是从n-1~0,和上面是反过来的</span></span><br><span class="line">			&#123;</span><br><span class="line">				z=v[p<span class="number">-1</span>];</span><br><span class="line">				y=v[p]-=MX;</span><br><span class="line">			&#125;</span><br><span class="line">			z=v[n<span class="number">-1</span>];</span><br><span class="line">			y=v[<span class="number">0</span>]-=MX;    <span class="comment">//这里的MX中传入的 p=0</span></span><br><span class="line">			sum-=DELTA;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">while</span>(--rounds);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> v[<span class="number">2</span>]=&#123;<span class="number">1</span>,<span class="number">2</span>&#125;;</span><br><span class="line">	<span class="type">uint32_t</span> <span class="type">const</span> k[<span class="number">4</span>]=&#123;<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;;</span><br><span class="line">	<span class="type">int</span> n=<span class="number">2</span>;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;加密前原始数据：%u %u\n&quot;</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);</span><br><span class="line">	btea(v,n,k);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;加密后数据：%u %u\n&quot;</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);</span><br><span class="line">	btea(v,-n,k);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;解密后数据：%u %u\n&quot;</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>python写法:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> * </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">MX</span>(<span class="params">z, y, sum1, k, p, e</span>):</span><br><span class="line">    <span class="keyword">return</span> c_uint32(((z.value&gt;&gt;<span class="number">5</span>^y.value&lt;&lt;<span class="number">2</span>)+(y.value&gt;&gt;<span class="number">3</span>^z.value&lt;&lt;<span class="number">4</span>))^((sum1.value^y.value)+(k[(p&amp;<span class="number">3</span>)^e.value]^z.value)))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">btea</span>(<span class="params">v,k,n,delta</span>):</span><br><span class="line"> </span><br><span class="line">	<span class="keyword">if</span> n&gt;<span class="number">1</span>:</span><br><span class="line">		sum1=c_uint32(<span class="number">0</span>)</span><br><span class="line">		z=c_uint32(v[n-<span class="number">1</span>])</span><br><span class="line">		rounds=<span class="number">6</span>+<span class="number">52</span>//n</span><br><span class="line">		e=c_uint32(<span class="number">0</span>)</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">while</span> rounds&gt;<span class="number">0</span>:</span><br><span class="line">			sum1.value+=delta</span><br><span class="line">			e.value=((sum1.value&gt;&gt;<span class="number">2</span>)&amp;<span class="number">3</span>)	<span class="comment">#e都要32位哦</span></span><br><span class="line">			<span class="keyword">for</span> p <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">1</span>):</span><br><span class="line">				y=c_uint32(v[p+<span class="number">1</span>])</span><br><span class="line">				<span class="comment">#v[p]=c_uint32(v[p]+c_uint32((((z.value&gt;&gt;5^y.value&lt;&lt;2)+(y.value&gt;&gt;3^z.value&lt;&lt;4))^((sum1.value^y.value)+(k[(p&amp;3)^e.value]^z.value)))).value).value</span></span><br><span class="line">				v[p] = c_uint32(v[p] + MX(z,y,sum1,k,p,e).value).value</span><br><span class="line">				z.value=v[p]</span><br><span class="line"> </span><br><span class="line">			y=c_uint32(v[<span class="number">0</span>])</span><br><span class="line">			<span class="comment">#v[n-1]=c_uint32(v[n-1]+c_uint32((((z.value&gt;&gt;5^y.value&lt;&lt;2)+(y.value&gt;&gt;3^z.value&lt;&lt;4))^((sum1.value^y.value)+(k[((n-1)&amp;3)^e.value]^z.value)))).value).value		#这里tmd传入的是k[((n-1)&amp;3)啊我草，找了半天！！！</span></span><br><span class="line">			v[n-<span class="number">1</span>] = c_uint32(v[n-<span class="number">1</span>] + MX(z,y,sum1,k,n-<span class="number">1</span>,e).value).value</span><br><span class="line">			z.value=v[n-<span class="number">1</span>]</span><br><span class="line">			rounds-=<span class="number">1</span></span><br><span class="line"> </span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		sum1=c_uint32(<span class="number">0</span>)</span><br><span class="line">		n=-n</span><br><span class="line">		rounds=<span class="number">6</span>+<span class="number">52</span>//n</span><br><span class="line">		sum1.value=rounds*delta</span><br><span class="line">		y=c_uint32(v[<span class="number">0</span>])</span><br><span class="line">		e=c_uint32(<span class="number">0</span>)</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">while</span> rounds&gt;<span class="number">0</span>:</span><br><span class="line">			e.value=((sum1.value&gt;&gt;<span class="number">2</span>)&amp;<span class="number">3</span>)	<span class="comment">#e都要32位哦</span></span><br><span class="line">			<span class="keyword">for</span> p <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">				z=c_uint32(v[p-<span class="number">1</span>])</span><br><span class="line">				<span class="comment">#y[p]=c_uint32(v[p]-c_uint32((((z.value&gt;&gt;5^y.value&lt;&lt;2)+(y.value&gt;&gt;3^z.value&lt;&lt;4))^((sum1.value^y.value)+(k[(p&amp;3)^e.value]^z.value)))).value).value</span></span><br><span class="line">				v[p] = c_uint32(v[p] - MX(z,y,sum1,k,p,e).value).value</span><br><span class="line">				y.value=v[p]</span><br><span class="line"> </span><br><span class="line">			z=c_uint32(v[n-<span class="number">1</span>])</span><br><span class="line">			<span class="comment">#v[n-1]=c_uint32(v[n-1]-c_uint32((((z.value&gt;&gt;5^y.value&lt;&lt;2)+(y.value&gt;&gt;3^z.value&lt;&lt;4))^((sum1.value^y.value)+(k[((n-1)&amp;3)^e.value]^z.value)))).value).value		#这里tmd传入的是k[((n-1)&amp;3)啊我草，找了半天！！！</span></span><br><span class="line">			v[<span class="number">0</span>] = c_uint32(v[<span class="number">0</span>] - MX(z,y,sum1,k,<span class="number">0</span>,e).value).value</span><br><span class="line">			y.value=v[<span class="number">0</span>]</span><br><span class="line">			sum1.value-=delta</span><br><span class="line">			rounds-=<span class="number">1</span></span><br><span class="line"> </span><br><span class="line">	<span class="keyword">return</span> v</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	a=[<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line">	k=[<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">	delta=<span class="number">0x9e3779b9</span></span><br><span class="line">	n=<span class="number">2</span></span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;加密前数据:&quot;</span>,a)</span><br><span class="line">	res=btea(a,k,n,delta)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;加密后数据:&quot;</span>,res)</span><br><span class="line">	res=btea(a,k,-n,delta)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;解密后数据:&quot;</span>,res)</span><br></pre></td></tr></table></figure>
<h2 id="四、总结"><a href="#四、总结" class="headerlink" title="四、总结"></a>四、总结</h2><p>TEA系列算法，判断可以根据每轮加密的情况，sum+的位置（TEA、XTEA），MX函数的有无（XXTEA特有），位与函数的有无（TEA没有位与），算法的复杂程度等等来判断，魔改的时候除了要注意主要的密文和key，还要观察<strong>delta值，各种位移的值，以及MX函数，轮数，是否融入其他运算</strong>，每轮的操作。<br>总和python脚本，方便对比：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> * </span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#This is a TEA &amp;XTEA Alogothim script.The v &amp; k need a list arg.</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tea_encrypt</span>(<span class="params">v,k</span>):</span><br><span class="line">	v0=c_uint32(v[<span class="number">0</span>])</span><br><span class="line">	v1=c_uint32(v[<span class="number">1</span>])</span><br><span class="line">	sum1=c_uint32(<span class="number">0</span>)</span><br><span class="line">	delta=<span class="number">0x9e3779b9</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">		sum1.value+=delta</span><br><span class="line">		v0.value+=((v1.value&lt;&lt;<span class="number">4</span>)+k[<span class="number">0</span>])^(v1.value+sum1.value)^((v1.value&gt;&gt;<span class="number">5</span>)+k[<span class="number">1</span>])</span><br><span class="line">		v1.value+=((v0.value&lt;&lt;<span class="number">4</span>)+k[<span class="number">2</span>])^(v0.value+sum1.value)^((v0.value&gt;&gt;<span class="number">5</span>)+k[<span class="number">3</span>])</span><br><span class="line">	<span class="keyword">return</span> v0.value,v1.value</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tea_decrypt</span>(<span class="params">v,k</span>):</span><br><span class="line">	v0=c_uint32(v[<span class="number">0</span>])</span><br><span class="line">	v1=c_uint32(v[<span class="number">1</span>])</span><br><span class="line">	delta=<span class="number">0x9e3779b9</span></span><br><span class="line">	sum1=c_uint32(delta*<span class="number">32</span>)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">		v1.value-=((v0.value&lt;&lt;<span class="number">4</span>)+k[<span class="number">2</span>])^(v0.value+sum1.value)^((v0.value&gt;&gt;<span class="number">5</span>)+k[<span class="number">3</span>])</span><br><span class="line">		v0.value-=((v1.value&lt;&lt;<span class="number">4</span>)+k[<span class="number">0</span>])^(v1.value+sum1.value)^((v1.value&gt;&gt;<span class="number">5</span>)+k[<span class="number">1</span>])</span><br><span class="line">		sum1.value-=delta</span><br><span class="line">	<span class="keyword">return</span> v0.value,v1.value</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xtea_encrypt</span>(<span class="params">v,k</span>):</span><br><span class="line">	v0=c_uint32(v[<span class="number">0</span>])</span><br><span class="line">	v1=c_uint32(v[<span class="number">1</span>])</span><br><span class="line">	sum1=c_uint32(<span class="number">0</span>)</span><br><span class="line">	delta=<span class="number">0x9e3779b9</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">		v0.value+=(((v1.value&lt;&lt;<span class="number">4</span>)^(v1.value&gt;&gt;<span class="number">5</span>))+v1.value)^(sum1.value+k[sum1.value&amp;<span class="number">3</span>])</span><br><span class="line">		sum1.value+=delta</span><br><span class="line">		v1.value+=(((v0.value&lt;&lt;<span class="number">4</span>)^(v0.value&gt;&gt;<span class="number">5</span>))+v0.value)^(sum1.value+k[(sum1.value&gt;&gt;<span class="number">11</span>)&amp;<span class="number">3</span>])</span><br><span class="line">	<span class="keyword">return</span> v0.value,v1.value</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xtea_decrypt</span>(<span class="params">v,k</span>):</span><br><span class="line">	v0=c_uint32(v[<span class="number">0</span>])</span><br><span class="line">	v1=c_uint32(v[<span class="number">1</span>])</span><br><span class="line">	delta=<span class="number">0x9e3779b9</span></span><br><span class="line">	sum1=c_uint32(delta*<span class="number">32</span>)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">		v1.value-=(((v0.value&lt;&lt;<span class="number">4</span>)^(v0.value&gt;&gt;<span class="number">5</span>))+v0.value)^(sum1.value+k[(sum1.value&gt;&gt;<span class="number">11</span>)&amp;<span class="number">3</span>])</span><br><span class="line">		sum1.value-=delta</span><br><span class="line">		v0.value-=(((v1.value&lt;&lt;<span class="number">4</span>)^(v1.value&gt;&gt;<span class="number">5</span>))+v1.value)^(sum1.value+k[sum1.value&amp;<span class="number">3</span>])</span><br><span class="line">	<span class="keyword">return</span> v0.value,v1.value</span><br><span class="line"><span class="comment">#Here is the XXtea.You should pay attenion to the v,k,n=v.len(),delta. Use -n to decrypt the cipher.</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">MX</span>(<span class="params">z, y, sum1, k, p, e</span>):</span><br><span class="line">    <span class="keyword">return</span> c_uint32(((z.value&gt;&gt;<span class="number">5</span>^y.value&lt;&lt;<span class="number">2</span>)+(y.value&gt;&gt;<span class="number">3</span>^z.value&lt;&lt;<span class="number">4</span>))^((sum1.value^y.value)+(k[(p&amp;<span class="number">3</span>)^e.value]^z.value)))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xxtea</span>(<span class="params">v,k,n,delta</span>):</span><br><span class="line">	<span class="keyword">if</span> n&gt;<span class="number">1</span>:</span><br><span class="line">		sum1=c_uint32(<span class="number">0</span>)</span><br><span class="line">		z=c_uint32(v[n-<span class="number">1</span>])</span><br><span class="line">		rounds=<span class="number">6</span>+<span class="number">52</span>//n</span><br><span class="line">		e=c_uint32(<span class="number">0</span>)</span><br><span class="line">		<span class="keyword">while</span> rounds&gt;<span class="number">0</span>:</span><br><span class="line">			sum1.value+=delta</span><br><span class="line">			e.value=((sum1.value&gt;&gt;<span class="number">2</span>)&amp;<span class="number">3</span>)	</span><br><span class="line">			<span class="keyword">for</span> p <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">1</span>):</span><br><span class="line">				y=c_uint32(v[p+<span class="number">1</span>])</span><br><span class="line">				v[p] = c_uint32(v[p] + MX(z,y,sum1,k,p,e).value).value</span><br><span class="line">				z.value=v[p]</span><br><span class="line">			y=c_uint32(v[<span class="number">0</span>])</span><br><span class="line">			v[n-<span class="number">1</span>] = c_uint32(v[n-<span class="number">1</span>] + MX(z,y,sum1,k,n-<span class="number">1</span>,e).value).value</span><br><span class="line">			z.value=v[n-<span class="number">1</span>]</span><br><span class="line">			rounds-=<span class="number">1</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		sum1=c_uint32(<span class="number">0</span>)</span><br><span class="line">		n=-n</span><br><span class="line">		rounds=<span class="number">6</span>+<span class="number">52</span>//n</span><br><span class="line">		sum1.value=rounds*delta</span><br><span class="line">		y=c_uint32(v[<span class="number">0</span>])</span><br><span class="line">		e=c_uint32(<span class="number">0</span>)</span><br><span class="line">		<span class="keyword">while</span> rounds&gt;<span class="number">0</span>:</span><br><span class="line">			e.value=((sum1.value&gt;&gt;<span class="number">2</span>)&amp;<span class="number">3</span>)	</span><br><span class="line">			<span class="keyword">for</span> p <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">				z=c_uint32(v[p-<span class="number">1</span>])</span><br><span class="line">				v[p] = c_uint32(v[p] - MX(z,y,sum1,k,p,e).value).value</span><br><span class="line">				y.value=v[p]</span><br><span class="line"> </span><br><span class="line">			z=c_uint32(v[n-<span class="number">1</span>])</span><br><span class="line">			v[<span class="number">0</span>] = c_uint32(v[<span class="number">0</span>] - MX(z,y,sum1,k,<span class="number">0</span>,e).value).value</span><br><span class="line">			y.value=v[<span class="number">0</span>]</span><br><span class="line">			sum1.value-=delta</span><br><span class="line">			rounds-=<span class="number">1</span></span><br><span class="line">	<span class="keyword">return</span> v</span><br><span class="line"><span class="comment">#print</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(v),<span class="number">2</span>):</span><br><span class="line">	s=xtea_decrypt(v[i:i+<span class="number">2</span>],k)</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">		flag+=n2s(s[j]).decode()[::-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>
<h2 id="五、例题"><a href="#五、例题" class="headerlink" title="五、例题"></a>五、例题</h2><h3 id="MoeCTF-2022-ezTea"><a href="#MoeCTF-2022-ezTea" class="headerlink" title="[MoeCTF 2022]ezTea"></a>[MoeCTF 2022]ezTea</h3><p>TEA<br>一个算法阅读题，需要注意的是，sum不再是uint32，而是直接的int32<br>delta&#x3D;0xd33b470<br>key&#x3D;[1,2,3,4]<br>exp如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> * </span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tea_decrypt</span>(<span class="params">v,k</span>):</span><br><span class="line">    v0=c_uint32(v[<span class="number">0</span>])</span><br><span class="line">    v1=c_uint32(v[<span class="number">1</span>])</span><br><span class="line">    delta=<span class="number">0xd33b470</span></span><br><span class="line">    sum1=c_int32(delta*<span class="number">32</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        v1.value-=((v0.value&lt;&lt;<span class="number">4</span>)+k[<span class="number">2</span>])^(v0.value+sum1.value)^((v0.value&gt;&gt;<span class="number">5</span>)+k[<span class="number">3</span>])</span><br><span class="line">        v0.value-=((v1.value&lt;&lt;<span class="number">4</span>)+k[<span class="number">0</span>])^(v1.value+sum1.value)^((v1.value&gt;&gt;<span class="number">5</span>)+k[<span class="number">1</span>])</span><br><span class="line">        sum1.value-=delta</span><br><span class="line">    <span class="keyword">return</span> v0.value,v1.value</span><br><span class="line"></span><br><span class="line">v= []</span><br><span class="line">k = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">b=[<span class="number">23</span>, <span class="number">101</span>, <span class="number">84</span>, <span class="number">137</span>, <span class="number">237</span>, <span class="number">101</span>, <span class="number">70</span>, <span class="number">50</span>, <span class="number">61</span>, <span class="number">88</span>, <span class="number">169</span>, <span class="number">253</span>, <span class="number">226</span>, <span class="number">94</span>, <span class="number">97</span>, <span class="number">151</span>, <span class="number">228</span>, <span class="number">96</span>, <span class="number">241</span>, <span class="number">145</span>, <span class="number">115</span>, <span class="number">233</span>, <span class="number">233</span>, <span class="number">162</span>, <span class="number">89</span>, <span class="number">203</span>, <span class="number">154</span>, <span class="number">153</span>, <span class="number">236</span>, <span class="number">177</span>, <span class="number">225</span>, <span class="number">125</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">32</span>,<span class="number">4</span>):</span><br><span class="line">    tmp=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">        tmp+=<span class="built_in">hex</span>(b[i+j])[<span class="number">2</span>:]</span><br><span class="line">    v.append(tmp)</span><br><span class="line">    v[-<span class="number">1</span>]=<span class="built_in">int</span>(v[-<span class="number">1</span>],<span class="number">16</span>)</span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(v)-<span class="number">1</span>,<span class="number">2</span>):</span><br><span class="line">    s=tea_decrypt(v[i:i+<span class="number">2</span>],k)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">        flag+=n2s(s[j]).decode()[::-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>moectf{Th3_TEA_!S_s0_t4s7y~~!!!}</p>
</blockquote>
<h3 id="HGAME-2023-week1-a-cup-of-tea"><a href="#HGAME-2023-week1-a-cup-of-tea" class="headerlink" title="[HGAME 2023 week1]a_cup_of_tea"></a>[HGAME 2023 week1]a_cup_of_tea</h3><p>TEA<br><img src="https://cdn.nlark.com/yuque/0/2023/png/36043746/1690908658208-869b1925-a80d-49ee-b20c-82665ca3f42e.png#averageHue=%2331302f&clientId=u3a08f1c9-e200-4&from=paste&height=577&id=u6c15326a&originHeight=721&originWidth=843&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=84803&status=done&style=none&taskId=u1f63a897-9d5b-4a19-8452-d604a1fc571&title=&width=674.4" alt="image.png"><br>操作是调用了四次TEA运算<br><img src="https://cdn.nlark.com/yuque/0/2023/png/36043746/1690908707208-0929dc44-a0a5-41bc-b043-41aebf987a38.png#averageHue=%232e2e2d&clientId=u3a08f1c9-e200-4&from=paste&height=406&id=ua502650c&originHeight=507&originWidth=1284&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=44101&status=done&style=none&taskId=ubcbe8e44-8b8d-425e-aed8-d86121116d7&title=&width=1027.2" alt="image.png"><br>TEA中，被魔改的delta&#x3D;0x543210dd,sum是递减的<br>key如下：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/36043746/1690908790721-d18e4654-6223-44d3-80a6-c54c6f491bb9.png#averageHue=%2333302e&clientId=u3a08f1c9-e200-4&from=paste&height=68&id=u7ef76667&originHeight=85&originWidth=1133&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=18139&status=done&style=none&taskId=ub97ddf54-b8fd-441e-b8c0-b277a3c81bf&title=&width=906.4" alt="image.png"><br>exp如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> * </span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tea_decrypt</span>(<span class="params">v,k</span>):</span><br><span class="line">    v0=c_uint32(v[<span class="number">0</span>])</span><br><span class="line">    v1=c_uint32(v[<span class="number">1</span>])</span><br><span class="line">    delta=<span class="number">0x543210dd</span></span><br><span class="line">    sum1=c_int32(-delta*<span class="number">32</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        v1.value-=((v0.value&lt;&lt;<span class="number">4</span>)+k[<span class="number">2</span>])^(v0.value+sum1.value)^((v0.value&gt;&gt;<span class="number">5</span>)+k[<span class="number">3</span>])</span><br><span class="line">        v0.value-=((v1.value&lt;&lt;<span class="number">4</span>)+k[<span class="number">0</span>])^(v1.value+sum1.value)^((v1.value&gt;&gt;<span class="number">5</span>)+k[<span class="number">1</span>])</span><br><span class="line">        sum1.value+=delta</span><br><span class="line">    <span class="keyword">return</span> v0.value,v1.value</span><br><span class="line"></span><br><span class="line">v= [<span class="number">0x2E63829D</span>, <span class="number">0xC14E400F</span>, <span class="number">0x9B39BFB9</span>, <span class="number">0x5A1F8B14</span>, <span class="number">0x61886DDE</span>, <span class="number">0x6565C6CF</span>, <span class="number">0x9F064F64</span>, <span class="number">0x236A43F6</span>, <span class="number">0x7D6B</span>]</span><br><span class="line">k = [<span class="number">0x12345678</span>, <span class="number">0x23456789</span>, <span class="number">0x34567890</span>, <span class="number">0x45678901</span>]</span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(v)-<span class="number">1</span>,<span class="number">2</span>):</span><br><span class="line">    s=tea_decrypt(v[i:i+<span class="number">2</span>],k)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">        flag+=n2s(s[j]).decode()[::-<span class="number">1</span>]</span><br><span class="line">flag+=n2s(v[-<span class="number">1</span>]).decode()[::-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="GDOUCTF-2023-Tea"><a href="#GDOUCTF-2023-Tea" class="headerlink" title="[GDOUCTF 2023] Tea"></a>[GDOUCTF 2023] Tea</h3><p>XTEA</p>
<h4 id="一、算法分析"><a href="#一、算法分析" class="headerlink" title="一、算法分析"></a>一、算法分析</h4><p>动态调试跑起来，来到这里：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/36043746/1690888791124-abc82fa2-3abd-45ad-9379-63d11edbc677.png#averageHue=%2330302f&clientId=u9105a869-8507-4&from=paste&height=666&id=uc5eff3ac&originHeight=833&originWidth=905&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=89539&status=done&style=none&taskId=uc20a2fc7-0586-472d-8c09-c4f5e33fd74&title=&width=724" alt="image.png">然后Line 36的函数一直跟进去，会发现有这样一串<br><img src="https://cdn.nlark.com/yuque/0/2023/png/36043746/1690888836901-b720eae1-a7c5-48ca-99d7-4e0f97e630ad.png#averageHue=%232f2f2f&clientId=u9105a869-8507-4&from=paste&height=424&id=u067bb7d7&originHeight=530&originWidth=1136&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=45602&status=done&style=none&taskId=u8d92923e-8c11-46e5-9483-871bec94a05&title=&width=908.8" alt="image.png"><br>根据这样一个特征，我们猜测，这是一个XTEA的算法，但是似乎有些魔改了<br>对比发现，他的delta值发生了变化，为256256256，<br>而sum的值因为是外面有一层0……8的循环，所以sum的值也在变化。<br>需要注意的是，这里的轮数不再是32，而是33，因为while后面跟的是&lt;&#x3D;<br>所以sum的表达式是sum1&#x3D;c_uint32(delta<em>i+delta</em>33)<br>其次观察第17行，与原来相比，再异或了一个sum，<br>其次解决密文和key的问题，主函数在24-27行已经给v6赋值了，但是下面Line34的函数又对v6进行处理，<br><img src="https://cdn.nlark.com/yuque/0/2023/png/36043746/1690889349707-71212879-8f27-4fc3-a6b9-8f0a39ecfc6a.png#averageHue=%23323130&clientId=u7a074c0b-ef38-4&from=paste&height=720&id=u42271f56&originHeight=900&originWidth=936&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=96536&status=done&style=none&taskId=u0518f3d1-b4fd-4e2c-8ed9-e86ce07289c&title=&width=748.8" alt="image.png"></p>
<h4 id="二、获取key"><a href="#二、获取key" class="headerlink" title="二、获取key"></a>二、获取key</h4><p><img src="https://cdn.nlark.com/yuque/0/2023/png/36043746/1690889421630-2b21c08d-29b0-416b-8ebd-df1dd12d14df.png#averageHue=%23313130&clientId=u7a074c0b-ef38-4&from=paste&height=466&id=ubbc86c6f&originHeight=582&originWidth=705&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=42507&status=done&style=none&taskId=ubcac83c8-5da7-494c-aeb7-0a794807788&title=&width=564" alt="image.png"><br>跟进去，发现他这里是将a1里面的值给修改了，<br>所以得到真正的key为k&#x3D;[2233,4455,6677,8899]<br><img src="https://cdn.nlark.com/yuque/0/2023/png/36043746/1690889478133-3f2c29c2-48cb-4a21-894e-5ecbbb608577.png#averageHue=%23312f2e&clientId=u7a074c0b-ef38-4&from=paste&height=346&id=u099317a9&originHeight=433&originWidth=944&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=47867&status=done&style=none&taskId=ue08d25e4-8d3f-4ddf-b685-058604c67d6&title=&width=755.2" alt="image.png"><br>密文则是跟进这个函数，这个函数本身的功能实际是一个结果的判断，程序的设计思路是：<br>enc(input)&#x3D;cipher<br><img src="https://cdn.nlark.com/yuque/0/2023/png/36043746/1690889506397-250716cd-eda1-4278-a6e1-6c31d9a8478e.png#averageHue=%23312f2e&clientId=u7a074c0b-ef38-4&from=paste&height=568&id=u419721a7&originHeight=710&originWidth=749&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=61734&status=done&style=none&taskId=ude0aceb1-a02b-48b1-be53-9f486879316&title=&width=599.2" alt="image.png"><br>提取出密文</p>
<blockquote>
<p>v&#x3D;[444599258, 4154859931, 1226314200, 4060164904, 359413339, 1013885656, 2228535080, 4045045479, 856928850, 3718242937]</p>
</blockquote>
<h4 id="三、exp："><a href="#三、exp：" class="headerlink" title="三、exp："></a>三、exp：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> * </span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xtea_decrypt</span>(<span class="params">v,k</span>):</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">		v0=c_uint32(v[j])</span><br><span class="line">		v1=c_uint32(v[j+<span class="number">1</span>])</span><br><span class="line">		delta=<span class="number">256256256</span></span><br><span class="line">		sum1=c_uint32(delta*j+delta*<span class="number">33</span>)</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>):</span><br><span class="line">			sum1.value-=delta</span><br><span class="line">			v1.value-=(((v0.value&lt;&lt;<span class="number">4</span>)^(v0.value&gt;&gt;<span class="number">5</span>))+v0.value)^(sum1.value+k[(sum1.value&gt;&gt;<span class="number">11</span>)&amp;<span class="number">3</span>])</span><br><span class="line">			v0.value-=(((v1.value&lt;&lt;<span class="number">4</span>)^(v1.value&gt;&gt;<span class="number">5</span>))+v1.value)^(sum1.value+k[sum1.value&amp;<span class="number">3</span>])^sum1.value</span><br><span class="line">		v[j]=v0.value</span><br><span class="line">		v[j+<span class="number">1</span>]=v1.value</span><br><span class="line">	<span class="keyword">return</span> v</span><br><span class="line">v=[<span class="number">444599258</span>, <span class="number">4154859931</span>, <span class="number">1226314200</span>, <span class="number">4060164904</span>, <span class="number">359413339</span>, <span class="number">1013885656</span>, <span class="number">2228535080</span>, <span class="number">4045045479</span>, <span class="number">856928850</span>, <span class="number">3718242937</span>]</span><br><span class="line">k=[<span class="number">2233</span>,<span class="number">4455</span>,<span class="number">6677</span>,<span class="number">8899</span>]</span><br><span class="line">s=xtea_decrypt(v,k)</span><br><span class="line">flag=<span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">	flag+=n2s(i)</span><br><span class="line"><span class="built_in">print</span>(flag.decode())</span><br></pre></td></tr></table></figure>
<blockquote>
<p>HZCTF{hzCtf_94_re666fingcry5641qq}</p>
</blockquote>
<h3 id="HNCTF-2022-WEEK2-TTTTTTTTTea"><a href="#HNCTF-2022-WEEK2-TTTTTTTTTea" class="headerlink" title="[HNCTF 2022 WEEK2]TTTTTTTTTea"></a>[HNCTF 2022 WEEK2]TTTTTTTTTea</h3><p>XTEA </p>
<h4 id="一、分析"><a href="#一、分析" class="headerlink" title="一、分析"></a>一、分析</h4><p>这是一道XTEA算法题，有位与操作参与<br><img src="https://cdn.nlark.com/yuque/0/2023/png/36043746/1690894043382-5955cfae-3a30-417b-9ea1-8370f505dce5.png#averageHue=%2352b9a4&clientId=u2f4df6e6-044a-4&from=paste&height=405&id=ud75b20a7&originHeight=506&originWidth=1666&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=111487&status=done&style=none&taskId=u5fb132a2-b12e-4ec4-893e-fd553b48a78&title=&width=1332.8" alt="image.png"><br>与一般的XTEA相比，有这些不同：<br>（1）delta&#x3D;0x61C88647<br>（2）sum不是递增的，而是递减<br>key如图所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/36043746/1690894220695-87d24eb2-6066-4115-8f5b-376ac85deefc.png#averageHue=%2335322f&clientId=uf6cae418-7d56-4&from=paste&height=79&id=u9e1c9008&originHeight=99&originWidth=806&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=13548&status=done&style=none&taskId=u7595a450-8073-45fb-8829-f65ada8b65f&title=&width=644.8" alt="image.png"><br>密文如图所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/36043746/1690894241856-d0943670-3109-4c09-a796-3b63be0230d0.png#averageHue=%2335302f&clientId=uf6cae418-7d56-4&from=paste&height=300&id=u877f2f2c&originHeight=375&originWidth=416&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=25924&status=done&style=none&taskId=uc04833df-12ca-4792-a73d-d60baafea79&title=&width=332.8" alt="image.png"><br>exp如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> * </span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xtea_decrypt</span>(<span class="params">v,k</span>):</span><br><span class="line">	v0=c_uint32(v[<span class="number">0</span>])</span><br><span class="line">	v1=c_uint32(v[<span class="number">1</span>])</span><br><span class="line">	delta=<span class="number">0x61C88647</span></span><br><span class="line">	sum1=c_uint32(-delta*<span class="number">32</span>)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">		v1.value-=(((v0.value&lt;&lt;<span class="number">4</span>)^(v0.value&gt;&gt;<span class="number">5</span>))+v0.value)^(sum1.value+k[(sum1.value&gt;&gt;<span class="number">11</span>)&amp;<span class="number">3</span>])</span><br><span class="line">		sum1.value+=delta</span><br><span class="line">		v0.value-=(((v1.value&lt;&lt;<span class="number">4</span>)^(v1.value&gt;&gt;<span class="number">5</span>))+v1.value)^(sum1.value+k[sum1.value&amp;<span class="number">3</span>])</span><br><span class="line">	v[<span class="number">0</span>]=v0.value</span><br><span class="line">	v[<span class="number">1</span>]=v1.value</span><br><span class="line">	<span class="keyword">return</span> v0.value,v1.value</span><br><span class="line">v=[<span class="number">0xC11EE75A</span>,<span class="number">0xA4AD0973</span>,<span class="number">0xF61C9018</span>,<span class="number">0x32E37BCD</span>,<span class="number">0x2DCC1F26</span>,<span class="number">0x344380CC</span>]</span><br><span class="line">k=[<span class="number">0x10203</span>,<span class="number">0x4050607</span>,<span class="number">0x8090a0b</span>,<span class="number">0xc0d0e0f</span>]</span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">6</span>,<span class="number">2</span>):</span><br><span class="line">	s=xtea_decrypt(v[i:i+<span class="number">2</span>],k)</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">		flag+=n2s(s[j]).decode()[::-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#NSSCTF&#123;Tea_TEA_TeA_TEa+&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="二、Patch调用后门解密函数："><a href="#二、Patch调用后门解密函数：" class="headerlink" title="二、Patch调用后门解密函数："></a>二、Patch调用后门解密函数：</h4><p>解释：<br>这道题因为提供了解密函数，因此我们可以直接来调用，只是传参要修改，<br>如图所示：一处是地址，一处是将调用的加密函数改成解密函数<br><img src="https://cdn.nlark.com/yuque/0/2023/png/36043746/1690902926321-875616e7-048d-474b-9d51-3cfd59f97e80.png#averageHue=%233f3c34&clientId=u1945dc3b-8316-4&from=paste&height=266&id=u07a212ca&originHeight=333&originWidth=1280&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=51058&status=done&style=none&taskId=u2a987b0c-6d84-4857-9f18-44627b8898d&title=&width=1024" alt="image.png"><br>具体操作：<br>在赋值语句结束处下断点，跑起来之后，断在这里，<img src="https://cdn.nlark.com/yuque/0/2023/png/36043746/1690903076488-9db8ed26-db83-4e75-8dec-780796661a15.png#averageHue=%23524e4c&clientId=u1945dc3b-8316-4&from=paste&height=186&id=u520507ed&originHeight=233&originWidth=696&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=33990&status=done&style=none&taskId=uae9ea0b6-b2cf-48b6-beaf-18a6e845821&title=&width=556.8" alt="image.png"><br>然后我们改rip到上面的for循环处，<br><img src="https://cdn.nlark.com/yuque/0/2023/png/36043746/1690903298908-8c50c983-0875-4918-b7af-043d4053fae6.png#averageHue=%234f4e4c&clientId=u1945dc3b-8316-4&from=paste&height=355&id=u5974e8f5&originHeight=444&originWidth=673&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=45864&status=done&style=none&taskId=u4cc74db6-0010-4257-907a-0f9fdc69975&title=&width=538.4" alt="image.png"><br>将补丁打上去：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">401759</span>                               loc_401759:                             ; CODE XREF: main+<span class="number">99</span>↓j</span><br><span class="line">.text:<span class="number">401759</span> <span class="number">8B</span> <span class="number">45</span> F0                      mov     eax, [rbp+var_10]               ; i</span><br><span class="line">.text:<span class="number">40175</span>C <span class="number">8</span>D <span class="number">14</span> <span class="number">00</span>                      lea     edx, [rax+rax]</span><br><span class="line">.text:<span class="number">40175F</span> <span class="number">48</span> <span class="number">8</span>D <span class="number">45</span> <span class="number">80</span>                   lea     rax, [rbp+var_80]               ; Keypatch modified this from:</span><br><span class="line">.text:<span class="number">40175F</span>                                                                       ;   lea rax, [rbp+var_60]</span><br><span class="line">.text:<span class="number">401763</span> <span class="number">48</span> <span class="number">63</span> D2                      movsxd  rdx, edx</span><br><span class="line">.text:<span class="number">401766</span> <span class="number">48</span> C1 E2 <span class="number">02</span>                   shl     rdx, <span class="number">2</span></span><br><span class="line">.text:<span class="number">40176</span>A <span class="number">48</span> <span class="number">01</span> D0                      add     rax, rdx</span><br><span class="line">.text:<span class="number">40176</span>D <span class="number">48</span> <span class="number">8</span>D <span class="number">15</span> <span class="number">9</span>C <span class="number">18</span> <span class="number">00</span> <span class="number">00</span>          lea     rdx, key</span><br><span class="line">.text:<span class="number">401774</span> <span class="number">48</span> <span class="number">89</span> C1                      mov     rcx, rax</span><br><span class="line">.text:<span class="number">401777</span> E8 <span class="number">8</span>E FE FF FF                call    tea_decrypt                     ; Keypatch modified this from:</span><br><span class="line">.text:<span class="number">401777</span>                                                                       ;   call tea_encrypt</span><br><span class="line">.text:<span class="number">401777</span></span><br><span class="line">.text:<span class="number">40177</span>C <span class="number">83</span> <span class="number">45</span> F0 <span class="number">01</span>                   add     [rbp+var_10], <span class="number">1</span> .text:<span class="number">000000000040177</span>C</span><br><span class="line">.text:<span class="number">401780</span></span><br><span class="line">.text:<span class="number">401780</span>                               loc_401780:                             ; CODE XREF: main+<span class="number">6</span>C↑j</span><br><span class="line">.text:<span class="number">401780</span> <span class="number">83</span> <span class="number">7</span>D F0 <span class="number">02</span>                   cmp     [rbp+var_10], <span class="number">2</span></span><br><span class="line">.text:<span class="number">401784</span> <span class="number">7</span>E D3                         jle     <span class="type">short</span> loc_401759                ; i</span><br></pre></td></tr></table></figure>
<p>在下面未重新赋值的地方下断点，运行，这样就解密结束了。<br><img src="https://cdn.nlark.com/yuque/0/2023/png/36043746/1690903353301-d12ee6e0-24d0-45fe-a2ea-3db426176c59.png#averageHue=%23504d4b&clientId=u1945dc3b-8316-4&from=paste&height=618&id=u51ea741c&originHeight=773&originWidth=1725&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=192748&status=done&style=none&taskId=u45e34456-668f-4727-8c01-d847dcb0234&title=&width=1380" alt="image.png"></p>
<h3 id="CTF-2023-ezcode"><a href="#CTF-2023-ezcode" class="headerlink" title="[*CTF 2023]ezcode"></a>[*CTF 2023]ezcode</h3><p>powershell混淆XXTEA<br>是一个powershell文件，改后缀为*.ps1<br>用powershell运行抓监控日志<br><img src="https://cdn.nlark.com/yuque/0/2023/png/36043746/1690864122057-441be926-d4df-4b59-be9b-e3a80c2eb406.png#averageHue=%23f1f1f0&clientId=u3451467c-b0e4-4&from=paste&height=798&id=u3733506c&originHeight=998&originWidth=1491&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=315524&status=done&style=none&taskId=uac3aee38-7a66-47b8-bf07-8693240f77f&title=&width=1192.8" alt="image.png"><br>得到：</p>
<blockquote>
<p>CommandInvocation(Invoke-Expression):“Invoke-Expression”<br>ParameterBinding(Invoke-Expression): 名称 &#x3D;“Command”；值 &#x3D;“Function <em>&#x2F;&#x3D;&#x3D;&#x2F;&#x3D;__&#x3D;</em>{<br>    [CmdletBinding()] param([Parameter(Position &#x3D; 0)][String] $param1)<br>    $result &#x3D; [Text.Encoding]::UTF8.GetString([Convert]::FromBase64String($param1))<br>    return $result<br>}<br>Function <em>/</em>_&#x3D;{<br>    [CmdletBinding()] param(  [Parameter(Position &#x3D; 0)]    [String]  $param1 )<br>    $param1 &#x3D; <em>&#x2F;&#x3D;&#x3D;&#x2F;&#x3D;__&#x3D;</em> -param1 $param1<br>    $result  &#x3D; [Text.Encoding]::UTF8.GetString([Convert]::FromBase64String($param1))<br>    $result | out-null<br>}<br><em>/</em>_&#x3D; (“S21OMFpudG9hR2hmY0hkemFGOXBjMTlsWVhONVgzSnBaMmgwUDMwPQ&#x3D;&#x3D;”)<br>echo “Do you konw PWSH?””</p>
</blockquote>
<p>很明显长度不对，且base64两次解出来的flag为假的flag，考虑是脚本中混杂着其他未执行的信息。</p>
<blockquote>
<p>*ctf{hhh_pwsh_is_easy_right?}</p>
</blockquote>
<p>在ISE里面调试，下断点，使用</p>
<blockquote>
<p>${]}<br>${@*}</p>
</blockquote>
<p>输出py脚本：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/36043746/1690865547581-5751be22-e2f6-4270-90f8-febd8959b706.png#averageHue=%23cacfbc&clientId=u59bf5e70-057e-4&from=paste&height=685&id=uc6deb264&originHeight=856&originWidth=1432&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=67224&status=done&style=none&taskId=u9fb03fab-9bdc-4a59-a881-125b545af8a&title=&width=1145.6" alt="image.png"><br>py脚本是一个魔改的XXTEA算法（有MX函数），key的四个值是md5的特征码。<br>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">MX</span>(<span class="params">z, y, total, key, p, e</span>):</span><br><span class="line">    temp1 = (z.value&gt;&gt;<span class="number">6</span> ^ y.value&lt;&lt;<span class="number">4</span>) + (y.value&gt;&gt;<span class="number">2</span> ^ z.value&lt;&lt;<span class="number">5</span>)</span><br><span class="line">    temp2 = (total.value ^ y.value) + (key[(p&amp;<span class="number">3</span>) ^ e.value] ^ z.value)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> c_uint32(temp1 ^ temp2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">n, v, key</span>):</span><br><span class="line">    delta = <span class="number">0x87654321</span></span><br><span class="line">    rounds = <span class="number">6</span> + <span class="number">52</span>//n</span><br><span class="line"></span><br><span class="line">    total = c_uint32(<span class="number">0</span>)</span><br><span class="line">    z = c_uint32(v[n-<span class="number">1</span>])</span><br><span class="line">    e = c_uint32(<span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> rounds &gt; <span class="number">0</span>:</span><br><span class="line">        total.value += delta  </span><br><span class="line">        e.value = (total.value &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span></span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">1</span>):</span><br><span class="line">            y = c_uint32(v[p+<span class="number">1</span>])</span><br><span class="line">            v[p] = c_uint32(v[p] + MX(z,y,total,key,p,e).value).value</span><br><span class="line">            z.value = v[p]</span><br><span class="line">        y = c_uint32(v[<span class="number">0</span>])</span><br><span class="line">        v[n-<span class="number">1</span>] = c_uint32(v[n-<span class="number">1</span>] + MX(z,y,total,key,n-<span class="number">1</span>,e).value).value</span><br><span class="line">        z.value = v[n-<span class="number">1</span>]</span><br><span class="line">        rounds -= <span class="number">1</span> </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">n, v, key</span>):</span><br><span class="line">    delta = <span class="number">0x87654321</span></span><br><span class="line">    rounds = <span class="number">6</span> + <span class="number">52</span>//n </span><br><span class="line">    </span><br><span class="line">    total = c_uint32(rounds * delta)</span><br><span class="line">    y = c_uint32(v[<span class="number">0</span>])</span><br><span class="line">    e = c_uint32(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> rounds &gt; <span class="number">0</span>:</span><br><span class="line">        e.value = (total.value &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span></span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">            z = c_uint32(v[p-<span class="number">1</span>])</span><br><span class="line">            v[p] = c_uint32((v[p] - MX(z,y,total,key,p,e).value)).value</span><br><span class="line">            y.value = v[p]</span><br><span class="line">        z = c_uint32(v[n-<span class="number">1</span>])  </span><br><span class="line">        v[<span class="number">0</span>] = c_uint32(v[<span class="number">0</span>] - MX(z,y,total,key,<span class="number">0</span>,e).value).value</span><br><span class="line">        y.value = v[<span class="number">0</span>]  </span><br><span class="line">        total.value -= delta</span><br><span class="line">        rounds -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> v </span><br><span class="line"></span><br><span class="line">v = [<span class="number">1374278842</span>, <span class="number">2136006540</span>, <span class="number">4191056815</span>, <span class="number">3248881376</span>]</span><br><span class="line">k0 = <span class="number">0x67452301</span></span><br><span class="line">k1 = <span class="number">0xefcdab89</span></span><br><span class="line">k2 = <span class="number">0x98badcfe</span></span><br><span class="line">k3 = <span class="number">0x10325476</span></span><br><span class="line">k = [k0, k1, k2, k3]</span><br><span class="line">n = <span class="number">4</span></span><br><span class="line"></span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line">res = decrypt(n, v, k)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">    tmp=<span class="built_in">hex</span>(i)[<span class="number">2</span>:]</span><br><span class="line">    s=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(tmp)-<span class="number">1</span>,<span class="number">2</span>):</span><br><span class="line">        s+=<span class="built_in">chr</span>(<span class="built_in">int</span>(tmp[j:j+<span class="number">2</span>],<span class="number">16</span>))</span><br><span class="line">    s=s[::-<span class="number">1</span>]</span><br><span class="line">    flag+=s</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;*ctf&#123;%s&#125;&quot;</span>%(flag))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>*ctf{yOUar3g0oD@tPw5H}</p>
</blockquote>
<h2 id="六、后记"><a href="#六、后记" class="headerlink" title="六、后记"></a>六、后记</h2><p>对比[GDOUCTF 2023] Tea和[HNCTF 2022 WEEK2]TTTTTTTTTea不难发现，<br>这些加密的时候，主要有两种方式，一种是<strong>分组加密，即每两个一组</strong>，另一种是<strong>每次相邻两个进行操作 ([GDOUCTF 2023] Tea)<strong>，除此之外，密文的传入和结果输出的时候也要注意</strong>大小端序的问题</strong>，以及格式。另外也要注意<strong>数据类型</strong>，如[Moectf 2022]ezTea里面，sum是**有符号的整数(int32)**。</p>

  </div>
  
</div>
          </div>
        </div>

        <link rel="stylesheet" href="/css/footer.css">
<div class="bottom-outer">
  <div class="copyright">©2024  By ZhaoWu</div>
  <div class="framework-info">
    <span>Power by</span>
    <a class="a1" target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>
    <span class="footer-separator">|</span>
    <span>Theme by</span>
    <a class="a2" target="_blank" rel="noopener" href="https://github.com/redhat123456/hexo-theme-MiHoYo">MiHoYo</a>
  </div>
</div>

          
            <!-- scripts list from theme config.yml -->
            
              <script src="/js/MiHoYo.js"></script>
              
                

  </body>

  </html>